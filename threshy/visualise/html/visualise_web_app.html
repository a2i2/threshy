<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>THRESHY</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" />
        <link rel="stylesheet" href="./style/style.css" />
        <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

        <!-- development version, includes helpful console warnings -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    </head>
    <body>
        <div id="app">
        <nav class="navbar" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a class="navbar-item" href="./">
                    <p><strong>THRESHY</strong><span> | Visualiser Tool</span></p>
                </a>
        
                <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
        
            <div id="navbarBasicExample" class="navbar-menu">
                <div class="navbar-start">
                    <a class="navbar-item" href="./">
                        Home
                    </a>
                </div>
        
                <div class="navbar-end">
        
                </div>
            </div>
        </nav>
        <hr class="hr" style="margin-top: 0"/> 

        <div class="container">
            <h1 class="title">Classification Visualiser
                <span v-if="isLoading" class="icon" style="margin-left: 10px"><i class="fas fa-sync fa-spin"></i></span>
            </h1>
            <button v-on:click="newModal.isActive = true" class="button is-success">New Visualisation</button>

            <div v-if="content.isActive">
                <hr class="hr" />

                <h2 class="title is-4">
                    Probability Thresholds: 
                </h2>
                <div v-for="group in thresholdGroups" class="columns">
                    <div v-for="threshold in group" class="column is-one-third">
                        <slider v-on:change="onThresholdChange" v-model="threshold.value" :slider-label="threshold.name" :event-data="threshold.name"></slider>
                    </div>
                </div>
                <hr class="hr" />

                <h2 class="title is-4">Summary:</h2>
                <table class="table is-fullwidth is-hoverable">
                    <tr>
                        <td><strong>True Positives</strong></td>
                        <td>{{ content.report.summary[0] }}</td>
                    </tr>
                    <tr>
                        <td><strong>False Positives</strong></td>
                        <td>{{ content.report.summary[1] }}</td>
                    </tr>
                    <tr>
                        <td><strong>Missed Positives</strong></td>
                        <td>{{ content.report.summary[2] }}</td>
                    </tr>
                    <tr>
                        <td><strong>Rejects</strong></td>
                        <td>{{ content.report.summary[3] }}</td>
                    </tr>
                </table>
                <hr class="hr" />

                <div class="columns">
                    <div class="column">
                        <h2 class="title is-4">Confusion Matrix:</h2>
                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Target Label:</label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth">
                                            <select v-on:change="onTargetLabelChange">
                                                <option v-for="(label, index) in content.report.labels" v-bind:selected="index == content.selectedMatrixIndex">{{ label }}</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <confusion-matrix :report="matrices[content.selectedMatrixIndex]"></confusion-matrix>
                        <div style="clear: both;">
                            <p><strong>Vertical Axis:</strong> Actual</p>
                            <p><strong>Horizontal Axis:</strong> Predicted</p>
                        </div>
                    </div>
                    <div class="column" style="clear: both">
                        <h2 class="title is-4">Cost Estimation:</h2>

                        <div class="field is-horizontal" style="clear: both">
                            <div class="field-label">
                                <label class="label">Portion Size:</label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control">
                                        <input v-model="content.portionSize" v-on:input="updateCost" class="input" type="number" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Estimate Size:</label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control">
                                        <input v-model="content.estimateSize" v-on:input="updateCost" class="input" type="number" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <confusion-matrix is-editable name="cost-matrix" :report="content.costMatrix" :on-new-matrix="onNewCostMatrix"></confusion-matrix>

                        <table class="table is-fullwidth" style="clear: both">
                            <tr>
                                <td><strong>Total True Positive Cost:</strong></td>
                                <td>{{ content.costResults != null ? ("$" + content.costResults.summary[0]) : "N/A" }}</td>
                                <td><strong>Total False Positive Cost:</strong></td>
                                <td>{{ content.costResults != null ? ("$" + content.costResults.summary[1]) : "N/A" }}</td>
                            </tr>
                            <tr>
                                <td><strong>Total Missed Positive Cost:</strong></td>
                                <td>{{ content.costResults != null ? ("$" + content.costResults.summary[2]) : "N/A" }}</td>
                                <td><strong>Total Reject Cost:</strong></td>
                                <td>{{ content.costResults != null ? ("$" + content.costResults.summary[3]) : "N/A" }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div v-bind:class="{ 'is-active': newModal.isActive }" class="modal">
                <div class="modal-background"></div>
                
                <div class="modal-card">
                    <div v-if="newModal.hasError" class="notification is-danger">
                        <button v-on:click="newModal.hasError = false" class="delete"></button>
                        <p>
                            <span class="icon"><i class="fas fa-exclamation-circle"></i></span>
                            <span><strong>ERROR:</strong> {{ newModal.errorMessage }} </span>
                        </p>
                    </div>
                    <div class="modal-card-head">
                        <div class="modal-card-title">New Visualisation</div>
                        <button v-on:click="newModal.isActive = false" class="delete"></button>
                    </div>
                    <div class="modal-card-body">
                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">CSV File:</label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control">
                                        <div class="file has-name">
                                            <label class="file-label">
                                                <input v-on:change="onFileQueue" class="file-input" type="file" />
                                                <span class="file-cta">
                                                    <span class="file-icon"><i class="fas fa-upload"></i></span>
                                                    <span class="file-label">Browse for CSV...</span>
                                                </span>
                                                <span class="file-name">{{ newModal.selectedFile != null ? newModal.selectedFile.name : "None selected" }}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">ID Column: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.idColumn" class="input" type="text" placeholder="Default: id" />
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Ground T Column: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.truthColumn" class="input" type="text" placeholder="Default: ground_truth" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Probability Column: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.probabilityColumn" class="input" type="text" placeholder="Default: None" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Reject Label: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.rejectLabel" class="input" type="text" placeholder="Default: REJECT" />
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Target Label: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.targetLabel" class="input" type="text" placeholder="Default: None" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Min: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.min" class="input" type="number" placeholder="Default: 0" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Max: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.max" class="input" type="number" placeholder="Default: 1" />
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <div class="field is-horizontal">
                            <div class="field-label">
                                <label class="label">Separator: </label>
                            </div>
                            <div class="field-body">
                                <div class="field">
                                    <div class="control is-expanded">
                                        <input v-model="newModal.separator" class="input" type="text" placeholder="Default: ," />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-card-foot">
                        <button v-on:click="upload" v-bind:class="{ 'is-loading': newModal.isLoading }" class="button is-success">Upload</button>
                        <button v-on:click="newModal.isActive = false" class="button is-danger">Cancel</button>
                    </div>
                </div>
            </div>
            <hr class="hr" style="clear: both" />
            <p>Alex Cummaudo & Scott Barnett</p>
        </div>
        </div>

        <!-- Import the custom Vue scripts -->
        <script type="text/javascript" src="./scripts/slider.js"></script>
        <script type="text/javascript" src="./scripts/confusion_matrix.js"></script>
        <script type="text/javascript" src="./scripts/main.js"></script>
    </body>
</html> 